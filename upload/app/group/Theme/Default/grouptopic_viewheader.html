<!--<include file="Core_Extend::template('header')" />-->

<!--{script}-->
function setGrouptopicstyle(nStyle){
	Dyhb.AjaxSend(D.U('group://grouptopic/set_grouptopicstyle?style='+nStyle),'','',completeSet);
}

function setGrouptopicside(nside){
	Dyhb.AjaxSend(D.U('group://grouptopic/set_grouptopicside?side='+nside),'','',completeSet);
}

function completeSet(data,status){
	if(status==1){
		window.location.reload();
	}
}

function grouptopicComment(nTid,nCid){
	oCommentNewtopics=windsforceAjax(D.U('group://grouptopic/commenttopic_dialog?tid='+nTid+(nCid?'&cid='+nCid:'')),'参与/回复帖子','',completeCommenttopic,'',400,100);
}

function completeCommenttopic(data,status){
	if(addGrouptopiccomment()==false){
		return false;
	}

	if(status==1){
		window.location.reload();
	}

	return true;
}

function grouptopiceditComment(nCid){
	oEditcommentNewtopics=windsforceAjax(D.U('group://grouptopic/editcommenttopic_dialog?cid='+nCid),'编辑帖子','',completeEditcommenttopic,'',400,100);
}

function completeEditcommenttopic(data,status){
	if(addGrouptopiccomment()==false){
		return false;
	}

	if(status==1){
		window.location.reload();
	}

	return true;
}
<!--{/script}-->

		<ul class="breadcrumb">
			<li><a href="<!--{:__APP__}-->" title="<!--<lang package='__COMMON_LANG__@Template/Common'>-->主页<!--</lang>-->"><i class='icon-home'></i></a>&nbsp;<span class="divider">/</span>&nbsp;</li>
			<li><a href="<!--{:Dyhb::U('group://public/index')}-->" title="小组">小组</a>&nbsp;<span class="divider">/</span>&nbsp;</li>
			<li><a href="<!--{:Group_Extend::getGroupurl($oGrouptopic->group)}-->"><!--{$oGrouptopic:group:group_nikename}--></a>&nbsp;<span class="divider">/</span>&nbsp;</li>
			<li>查看帖子</li>
		</ul>

<!--{if Groupadmin_Extend+checkCommentadminRbac($oGrouptopic->group) || Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group)}-->
<script src="<!--{:__APPPUB__}-->/Js/moderator.js"></script>
<!--{/if}-->

<script src="<!--{:__PUBLIC__}-->/js/jquery/autoresize/jquery.autoresize.js"></script>

<!--{:Core_Extend::editorInclude()}-->
<!--{:Core_Extend::emotion()}-->

<!--{script}-->
$(function(){
	<!--{if $GLOBALS['___login___']!==false && $oGrouptopic['grouptopic_iscomment']==1 && $oGrouptopic['grouptopic_isclose']=='0'}-->
	editorSimple=loadEditorThin('simple_grouptopiccomment_message');
	$(".face-icon").jqfaceedit({txtAreaObj:editorSimple,containerObj:$('#emotion_parentcontainer'),top:25,left:-27});

	$('.grouptopiccomment_quickmessage').autoResize({
		onResize:function(){
			$(this).css({opacity:0.8});
		},
		animateCallback:function(){
			$(this).css({opacity:1});
		},
		animateDuration:300,
		extraSpace:0,
		min:'80px'
	});
	<!--{/if}-->
	
	$("#grouptopiccomment_quickmessage").focus(function(){
		$("#grouptopiccomment_reply").css("display","block");
	});

	$('.grouptopiccontent_box').emotionsToHtml();
});

function closeQuickreplay(){
	$("#grouptopiccomment_reply").css("display","none");
}

function addGrouptopiccommentquick(){
	var sCommentMessage=$("#grouptopiccomment_quickmessage").val();
	var sCommentName=$("#grouptopiccomment_quickname").val();
	var sCommentEmail=$("#grouptopiccomment_quickemail").val();
	var sCommentUrl=$("#grouptopiccomment_quickurl").val();

	if(!sCommentMessage){
		windsforceAlert('回复内容不能为空','',3);
		return false;
	}

	var sParameter="ajax=1&grouptopiccomment_message="+encodeURIComponent(sCommentMessage)+"&tid="+<!--{$oGrouptopic->grouptopic_id}-->+'&grouptopiccomment_name='+encodeURIComponent(sCommentName)+'&grouptopiccomment_email='+encodeURIComponent(sCommentEmail)+'&grouptopiccomment_url='+encodeURIComponent(sCommentUrl);

	Dyhb.AjaxSend('<!--{:Dyhb::U('group://grouptopic/add_reply')}-->',sParameter,'',function(data,status){
		if(status==1){
			window.location.href=data.url;
		}
	});
}

function addGrouptopiccommentSimple(){
	sGrouptopiccommentmessage=$.trim(editorSimple.html());
	$('#simple_grouptopiccomment_message').val(sGrouptopiccommentmessage);

	$("#submit_button").attr("disabled", "disabled");
	$("#submit_button").val( 'add...' );

	if(!sGrouptopiccommentmessage){
		windsforceAlert('回复内容不能为空','',3);
		$("#submit_button").attr("disabled", false);
		$("#submit_button").val( '发布' );
		return false;
	}

	$('#simple_comment').val('1');

	Dyhb.AjaxSubmit("grouptopiccomment_form",'<!--{:Dyhb::U('group://grouptopic/add_reply')}-->','',function(data,status){
		$('#simple_comment').val('0');

		$("#submit_button").attr("disabled", false);
		$("#submit_button").val( '发布' );
		
		if(status==1){
			window.location.href=data.url;
		}
	});
}

function showMediaSimple(){
	$('#simple-grouptopiccomment-media-box').toggle('fast');
}

function insertGrouptopicattachmentSimple(nAttachmentid){
	insertAttachment(editorSimple,nAttachmentid);
}

function insertGrouptopicvideoSimple(sContent){
	insertVideo(editorSimple,sContent);
}

function insertGrouptopicmusicSimple(sContent){
	insertMusic(editorSimple,sContent);
}

var nGroupid=parseInt('<!--{$oGrouptopic['group_id']}-->'),nGrouptopicid=parseInt('<!--{$oGrouptopic['grouptopic_id']}-->');
<!--{/script}-->

<!--{if Groupadmin_Extend+checkCommentadminRbac($oGrouptopic->group)}-->
<form method="post" autocomplete="off" name="modActionsBox" id="modActionsBox">
</form>

<div id="modActionSelect" class="commonbox_mini commonbox_mini_gray" style="display:none;z-index:350;">
	<h2 class="title">选中&nbsp;<strong id="modActionSelectnum"></strong>&nbsp;篇</h2>
	<div class="modActionSelectcontent">
		<!--{if Groupadmin_Extend+checkCommentadminRbac($oGrouptopic->group,array('group@grouptopicadmin@auditcomment'))}-->
		<a href="javascript:void(0);" onclick="modCommentaudit();">审核</a>
		<span class="pipe">|</span>
		<!--{/if}-->
		<!--{if Groupadmin_Extend+checkCommentadminRbac($oGrouptopic->group,array('group@grouptopicadmin@hidecomment'))}-->
		<a href="javascript:void(0);" onclick="modCommenthide();">屏蔽</a>
		<span class="pipe">|</span>
		<!--{/if}-->
		<!--{if Groupadmin_Extend+checkCommentadminRbac($oGrouptopic->group,array('group@grouptopicadmin@deletecomment'))}-->
		<a href="javascript:void(0);" onclick="modCommentdelete();">删除</a>
		<span class="pipe">|</span>
		<!--{/if}-->
		<!--{if Groupadmin_Extend+checkCommentadminRbac($oGrouptopic->group,array('group@grouptopicadmin@stickreplycomment'))}-->
		<a href="javascript:void(0);" onclick="modCommentstickreply();">置顶</a>
		<!--{/if}-->
	</div>
</div>
<!--{/if}-->

		<!--<include file="group+header" />-->

			<div class="span12">
				<div class="tabb-menu">
					<ul class="nav nav-pills">
						<!--{if $GLOBALS['_cache_']['group_option']['group_grouptopicstyle_on']==1 || $GLOBALS['_cache_']['group_option']['group_grouptopicside_on']==1}-->
						<!--{if $GLOBALS['_cache_']['group_option']['group_grouptopicstyle_on']==1}-->
						<li <!--{if $nStyle==1}-->class="active"<!--{/if}-->><a href="javascript:void(0);" onclick="setGrouptopicstyle(1);">传统BBS</a></li>
						<li <!--{if $nStyle==2}-->class="active"<!--{/if}-->><a href="javascript:void(0);" onclick="setGrouptopicstyle(2);">小组新风格</a></li>
						<!--{/if}-->
						<!--{if $GLOBALS['_cache_']['group_option']['group_grouptopicside_on']==1}-->
						<!--{if $nSide==2}-->
						<li><a href="javascript:void(0);" onclick="setGrouptopicside(1);">关闭侧边栏</a></li>
						<!--{d*else}-->
						<li><a href="javascript:void(0);" onclick="setGrouptopicside(2);">打开侧边栏</a></li>
						<!--{/if}-->
						<!--{/if}-->
						<!--{/if}-->
					</ul>
				</div>
			</div>
			
			<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group)}-->
			<div class="span12" style="margin-bottom:15px;">
				<div>
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@deletetopic'))}-->
					<a onclick="modTopicdelete();" href="javascript:void(0);">删除主题</a>
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@closetopic'))}-->
					<!--{if $oGrouptopic['grouptopic_isclose']=='0'}-->
					<a onclick="modTopicclose(1);" href="javascript:void(0);">关闭</a>
					<!--{d*else}-->
					<a onclick="modTopicclose(0);" href="javascript:void(0);">打开</a>
					<!--{/if}-->
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@sticktopic'))}-->
					<a onclick="modTopicstick(<!--{if $oGrouptopic['grouptopic_sticktopic']>0}--><!--{$oGrouptopic['grouptopic_sticktopic']}--><!--{d*else}-->0<!--{/if}-->);" href="javascript:void(0);">置顶</a>
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@digesttopic'))}-->
					<a onclick="modTopicdigest(<!--{if $oGrouptopic['grouptopic_addtodigest']>0}--><!--{$oGrouptopic['grouptopic_addtodigest']}--><!--{d*else}-->0<!--{/if}-->);" href="javascript:void(0);">精华</a>
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@recommendtopic'))}-->
					<a onclick="modTopicrecommend(<!--{if $oGrouptopic['grouptopic_isrecommend']>0}--><!--{$oGrouptopic['grouptopic_isrecommend']}--><!--{d*else}-->0<!--{/if}-->);" href="javascript:void(0);">推荐</a>
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@hidetopic'))}-->
					<!--{if $oGrouptopic['grouptopic_isaudit']=='0'}-->
					<a onclick="modTopicstatus(1);" href="javascript:void(0);">显示</a>
					<!--{d*else}-->
					<a onclick="modTopicstatus(0);" href="javascript:void(0);">隐藏</a>
					<!--{/if}-->
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@categorytopic'))}-->
					<a onclick="modTopiccategory(<!--{$oGrouptopic['grouptopiccategory_id']}-->);" href="javascript:void(0);">分类</a>
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@tagtopic'))}-->
					<a onclick="modTopictag();" href="javascript:void(0);">标签</a>
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Groupadmin_Extend+checkTopicadminRbac($oGrouptopic->group,array('group@grouptopicadmin@colortopic'))}-->
					<a onclick="modTopiccolor();" href="javascript:void(0);">高亮</a>
					<span class="pipe">|</span>
					<!--{/if}-->
					<!--{if Core_Extend+isAdmin()}-->
					<img src="<!--{:__APPPUB__}-->/Images/recyclebin.gif" />&nbsp;
					<a href="<!--{:Core_Extend::windsforceOuter('c=app&a=config&id=3&controller=grouptopiccomment&tid='.$oGrouptopic['grouptopic_id'].'&status=0','admin.php')}-->" target="_blank">回帖回收站</a>&nbsp;<span><a href="<!--{:Core_Extend::windsforceOuter('c=app&a=config&id=3&controller=grouptopiccomment&tid='.$oGrouptopic['grouptopic_id'].'&status=0','admin.php')}-->" target="_blank" <!--{if $nTotalRecyclebinComment>0}-->style="color:red;font-weight:bold;"<!--{/if}-->>(<!--{$nTotalRecyclebinComment}-->)</a></span>
					<!--{/if}-->
				</div>
			</div>
			<!--{/if}-->