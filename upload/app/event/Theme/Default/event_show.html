<!--<include file="Core_Extend::template('header')" />-->

<!--{:Core_Extend::emotion()}-->

<script src="<!--{:__PUBLIC__}-->/js/jquery/jquery.insertcontent.js"></script>
<script src="<!--{:__PUBLIC__}-->/js/jquery/autoresize/jquery.autoresize.js"></script>

<!--{script}-->
function joinEvent(nId){
	oJoinevents=windsforceAjax(D.U('event://event/join?id='+nId),'<!--<lang package='Template'>-->参加活动<!--</lang>-->','',completeJoinevent,'',400,100);
}

function completeJoinevent(){
	Dyhb.AjaxSubmit("joineventform",'<!--{:Dyhb::U('event://event/join_in')}-->','result',function(data,status){
		if(status==1){
			setTimeout("window.location.replace(_SELF_);",1000);
			return true;
		}
	});
	
	return false;
}

function attentionEvent(nId){
	Dyhb.AjaxSend(D.U('event://event/attention'),'ajax=1&id='+nId,'',function(data,status){
		if(status==1){
			setTimeout("window.location.replace(_SELF_);",1000);
		}
	});
}

$(function(){
	$('.eventcomment-content').emotionsToHtml();
	
	$('#eventcomment_content').autoResize({
		onResize:function(){
			$(this).css({opacity:0.8});
		},
		animateCallback:function(){
			$(this).css({opacity:1});
		},
		animateDuration:300,
		extraSpace:0,
		min:'100px'
	});

	$(".face-icon").jqfaceedit({txtAreaObj:$("#eventcomment_content"),textareaid:'eventcomment_content',containerObj:$('#emotion_parentcontainer'),top:25,left:-27});
});

function commentCheckForm(comment_content,customContent){
	var comment_name=$.trim($('#eventcomment_name').val());
	var comment_email=$.trim($("#eventcomment_email").val());
	var comment_url=$.trim($("#eventcomment_url").val());
	if(customContent==1){
		comment_content=$.trim($("#eventcomment_content").val());
	}

	if(comment_name==""){
		windsforceAlert(D.L('评论名字不能为空','__COMMON_LANG__@Common'),D.L('评论发生错误','__COMMON_LANG__@Common'),3);
		return false;
	}

	if(comment_name.length>25){
		windsforceAlert(D.L('评论名字长度只能小于等于25个字符串','__COMMON_LANG__@Common'),D.L('评论发生错误','__COMMON_LANG__@Common'),3);
		return false;
	}

	if(comment_email!='' && !checkEmail(comment_email)){
		windsforceAlert(D.L('评论E-mail 格式错误','__COMMON_LANG__@Common'),D.L('评论发生错误','__COMMON_LANG__@Common'),3);
		return false;
	}

	if(comment_url!='' && !checkUrl(comment_url)){
		windsforceAlert(D.L('评论Url 格式错误','__COMMON_LANG__@Common'),D.L('评论发生错误','__COMMON_LANG__@Common'),3);
		return false;
	}

	if(comment_content == ""){
		windsforceAlert(D.L('评论内容不能为空','__COMMON_LANG__@Common'),D.L('评论发生错误','__COMMON_LANG__@Common'),3);
		return false;
	}

	return true;
}

function commentSubmit(){
	var bResult=commentCheckForm();
	if(bResult===false){
		return false;
	}

	$("#comment-submit").val(D.L('正在提交评论','__COMMON_LANG__@Common'));
	$("#comment-submit").attr("disabled", "disabled");
	Dyhb.AjaxSubmit('event-commentform',D.U('event://event/add_eventcomment'),'',commentComplete);
}

function commentComplete(data,status){
	$("#comment-submit").attr("disabled", false);
	$("#comment-submit").val(D.L('提交评论','__COMMON_LANG__@Common'));
	if(status==1){
		setTimeout(function(){window.location.href=data.jumpurl;},1000);
	}
}

function eventcommentAudit(nCommentid,nStatus){
	Dyhb.AjaxSend(D.U('event://event/audit_eventcomment?id='+nCommentid+'&status='+nStatus),'ajax=1','',function(data,status){
		if(status==1){
			setTimeout("window.location.replace(_SELF_);",1000);
		}
	});
}

function showMedia(){
	$('#eventcomment-media-box').toggle('fast');
}

function insertEventcommentattachment(nAttachmentid){
	insertAttachmentNormal('eventcomment_content',nAttachmentid);
}

function insertEventcommentvideo(sContent){
	insertVideoNormal('eventcomment_content',sContent);
}

function insertEventcommentmusic(sContent){
	insertMusicNormal('eventcomment_content',sContent);
}
<!--{/script}-->

		<ul class="breadcrumb">
			<li><a href="<!--{:__APP__}-->" title="<!--<lang package='__COMMON_LANG__@Common'>-->主页<!--</lang>-->"><i class='icon-home'></i></a>&nbsp;<span class="divider">/</span>&nbsp;</li>
			<li><a href="<!--{:Dyhb::U('event://public/index')}-->" title="<!--<lang package='Template'>-->活动<!--</lang>-->"><!--<lang package='Template'>-->活动<!--</lang>--></a>&nbsp;<span class="divider">/</span>&nbsp;</li>
			<li><!--{$oEvent['event_title']}--></li>
		</ul>

		<div class="row">
			<div class="span8">
				<h3 class="event_title" style="margin-bottom:10px;"><!--{$oEvent['event_title']}--></h3>
				
				<!--<include file="event+menu" />-->

				<div class="row">
					<div class="span3">
						<img class="thumbnail" src="<!--{:Event_Extend::getEventcolor($oEvent)}-->" alt="<!--{$oEvent['event_title']}-->">
						<br/>
						<a class="btn" href="javascript:void(0);" onclick="attentionEvent('<!--{$oEvent->event_id}-->');">我感兴趣</a>&nbsp;<a class="btn btn-success" href="javascript:void(0);" onclick="joinEvent('<!--{$oEvent->event_id}-->');">我要参加</a>
					</div>
					<div class="span5">
						<table class="table">
							<thead>
								<tr>
									<th colspan="2">活动项目</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>发起者</td>
									<td><a href="<!--{:Dyhb::U('home://space@?id='.$oEvent['user_id'])}-->"><!--{$oEvent['event_username']}--></a></td>
								</tr>
								<tr>
									<td>联系方式</td>
									<td><!--{if $oEvent['event_contactsite']}--><a href="<!--{$oEvent['event_contactsite']}-->"><!--{$oEvent['event_contact']}--></a><!--{d*else}--><!--{$oEvent['event_contact']}--><!--{/if}--></td>
								</tr>
								<tr>
									<td>联合联系方式</td>
									<td><!--{if $oEvent['event_jointcontactsite']}--><a href="<!--{$oEvent['event_jointcontactsite']}-->"><!--{$oEvent['event_jointcontact']}--></a><!--{d*else}--><!--{$oEvent['event_jointcontact']}--><!--{/if}--></td>
								</tr>
								<tr>
									<td>活动时间</td>
									<td><!--{$oEvent['event_starttime']|date="Y-m-d H:i:s",**}--> 至 <!--{$oEvent['event_endtime']|date="Y-m-d H:i:s",**}--></td>
								</tr>
								<tr>
									<td>活动地点</td>
									<td><!--{$oEvent['event_address']}--></td>
								</tr>
								<tr>
									<td>活动经费</td>
									<td><!--{$oEvent['event_cost']}--><!--{if $oEvent['event_costdescription']}-->&nbsp;(<!--{$oEvent['event_costdescription']}-->)<!--{/if}--></td>
								</tr>
								<tr>
									<td>报名截止时间</td>
									<td><!--{$oEvent['event_deadline']|date="Y-m-d H:i:s",**}--></td>
								</tr>
								<tr>
									<td>剩余名额</td>
									<td><!--{if $oEvent['event_limitcount']>0}--><!--{$oEvent['event_limitcount']-$oEvent['event_joincount']}--><!--{d*else}-->参加人数不限制<!--{/if}--></td>
								</tr>
								<tr>
									<td>参加是否需要审核</td>
									<td><!--{if $oEvent['event_isaudit']==1}-->是<!--{d*else}-->否<!--{/if}--></td>
								</tr>
								<tr>
									<td colspan="2"><b><!--{$oEvent['event_attentioncount']}--></b>人感兴趣&nbsp; <b><!--{$oEvent['event_joincount']}--></b>人参加</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div class="commonbox" style="margin-top:20px;">
					<div class="commonboxtitle"><!--<lang package='Template'>-->活动介绍<!--</lang>--></div>
					<div class="backgroup_box">
						<p><!--{$oEvent['event_content']}--></p>
					</div>
				</div>
				
				<div class="commonbox" style="margin-top:20px;">
					<div class="commonboxtitle"><!--<lang package='Template'>-->活动照片<!--</lang>--></div>
					<div class="backgroup_box">
						<p><!--{$oEvent['event_content']}--></p>
					</div>
				</div>
				
				<div class="common_share clearfix">
					<!--{:Core_Extend::share()}-->
				</div>
				
				<!--{# 评论列表}-->
				<!--<include file="event+commentlist" />-->

				<!--{# 评论表单}-->
				<!--<include file="event+commentform" />-->
			</div>
			<div class="span4">
				<div class="commonbox">
					<div class="backgroup_box">
						<p><a class="btn btn-success" href="/windsforce/upload/index.php/app/group/gid/default"><i class="icon-share-alt icon-white"></i>&nbsp;返回小组</a></p>
					</div>
				</div>

				<div class="commonbox">
					<div class="commonboxtitle">活动组织者</div>
					<p>
						<!--{if !empty($oAdminuser)}-->
						<ul class="thumbnails">
							<li class="span1">
								<div class="thumbnail">
									<a href="<!--{:Dyhb::U('home://space@?id='.$oAdminuser['user_id'])}-->"><img src="<!--{:Core_Extend::avatar( $oAdminuser['user_id'],'small' )}-->" width="100%" title="<!--<lang package='Template'>-->发起者<!--</lang>--> <!--{:UserModel::getUsernameById($oAdminuser['user_id'])}--> - <!--<lang package='Template'>-->创建时间<!--</lang>--> <!--{$oAdminuser['create_dateline']|Core_Extend+timeFormat}-->" alt="<!--<lang package='Template'>-->活动成员<!--</lang>--> <!--{:UserModel::getUsernameById($oAdminuser['user_id'])}-->"></a>
									<a rel="tooltip" title="<!--<lang package='Template'>-->发起者<!--</lang>--> <!--{:UserModel::getUsernameById($oAdminuser['user_id'])}--> | <!--<lang package='Template'>-->创建时间<!--</lang>--> <!--{$oAdminuser['create_dateline']|Core_Extend+timeFormat}-->" href="<!--{:Dyhb::U('home://space@?id='.$oAdminuser['user_id'])}-->"><h5 style="text-align:center;"><!--{:G::subString(UserModel::getUsernameById($oAdminuser['user_id']),0,3)}--></h5></a>
								</div>
							</li>
						</ul>
						<!--{d*else}-->
						<!--<lang package='Template'>-->暂时没有发现活动发起人<!--</lang>-->
						<!--{/if}-->
					</p>
				</div>
				
				<div class="commonbox_mini commonbox_mini_gray">
					<h2 class="title"><!--<lang package='Template'>-->活动成员<!--</lang>--></h2>
					<p>
						<ul class="thumbnails">
							<!--{if is_array($arrNeweventusers)}-->
							<!--<foreach for=arrNeweventusers value=oNeweventuser>-->
							<li class="span1">
								<div class="thumbnail">
									<a href="<!--{:Dyhb::U('home://space@?id='.$oNeweventuser['user_id'])}-->"><img src="<!--{:Core_Extend::avatar( $oNeweventuser['user_id'],'small' )}-->" width="100%" title="<!--<lang package='Template'>-->活动成员<!--</lang>--> <!--{:UserModel::getUsernameById($oNeweventuser['user_id'])}--> - <!--<lang package='Template'>-->创建时间<!--</lang>--> <!--{$oNeweventuser['create_dateline']|Core_Extend+timeFormat}-->" alt="<!--<lang package='Template'>-->活动成员<!--</lang>--> <!--{:UserModel::getUsernameById($oNeweventuser['user_id'])}-->"></a>
									<a rel="tooltip" title="<!--<lang package='Template'>-->活动成员<!--</lang>--> <!--{:UserModel::getUsernameById($oNeweventuser['user_id'])}--> | <!--<lang package='Template'>-->创建时间<!--</lang>--> <!--{$oNeweventuser['create_dateline']|Core_Extend+timeFormat}-->" href="<!--{:Dyhb::U('home://space@?id='.$oNeweventuser['user_id'])}-->"><h5 style="text-align:center;"><!--{:G::subString(UserModel::getUsernameById($oNeweventuser['user_id']),0,3)}--></h5></a>
								</div>
							</li>
							<!--</foreach>-->
							<!--{d*else}-->
							<li><!--<lang package='Template'>-->暂时没有发现任何活动成员<!--</lang>--></li>
							<!--{/if}-->
						</ul>
					</p>
				</div>
				
				<div class="commonbox_mini commonbox_mini_gray">
					<h2 class="title">感兴趣成员</h2>
					<p>
						<ul class="thumbnails">
							<!--{if is_array($arrNeweventattentionusers)}-->
							<!--<foreach for=arrNeweventattentionusers value=oNeweventattentionuser>-->
							<li class="span1">
								<div class="thumbnail">
									<a href="<!--{:Dyhb::U('home://space@?id='.$oNeweventattentionuser['user_id'])}-->"><img src="<!--{:Core_Extend::avatar( $oNeweventattentionuser['user_id'],'small' )}-->" width="100%" title="<!--<lang package='Template'>-->活动成员<!--</lang>--> <!--{:UserModel::getUsernameById($oNeweventattentionuser['user_id'])}--> - <!--<lang package='Template'>-->创建时间<!--</lang>--> <!--{$oNeweventattentionuser['create_dateline']|Core_Extend+timeFormat}-->" alt="<!--<lang package='Template'>-->活动成员<!--</lang>--> <!--{:UserModel::getUsernameById($oNeweventattentionuser['user_id'])}-->"></a>
									<a rel="tooltip" title="<!--<lang package='Template'>-->活动成员<!--</lang>--> <!--{:UserModel::getUsernameById($oNeweventattentionuser['user_id'])}--> | <!--<lang package='Template'>-->创建时间<!--</lang>--> <!--{$oNeweventattentionuser['create_dateline']|Core_Extend+timeFormat}-->" href="<!--{:Dyhb::U('home://space@?id='.$oNeweventattentionuser['user_id'])}-->"><h5 style="text-align:center;"><!--{:G::subString(UserModel::getUsernameById($oNeweventattentionuser['user_id']),0,3)}--></h5></a>
								</div>
							</li>
							<!--</foreach>-->
							<!--{d*else}-->
							<li><!--<lang package='Template'>-->暂时没有发现任何感兴趣成员<!--</lang>--></li>
							<!--{/if}-->
						</ul>
					</p>
				</div>
			</div>
		</div>

<!--<include file="Core_Extend::template('footer')" />-->
